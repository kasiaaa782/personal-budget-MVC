{% extends "base.html" %}

{% block title %}Budżet osobisty - Dodawanie wydatku{% endblock %}

{% block navigation %}

<nav class="navbar navbar-dark navbar-expand-lg">
  <button class="navbar-toggler mx-auto" type="button" data-toggle="collapse" data-target="#mainmenu"
    aria-controls="mainmenu" aria-expanded="false" aria-label="Przełącznik nawigacji">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="mainmenu">
    <ol class="navbar-nav mx-auto">
      <li class="nav-item mx-auto"><a class="nav-link" href="/posts/index">Strona główna</a></li>
      <li class="nav-item mx-auto"><a class="nav-link" href="/posts/income">Dodaj przychód</a></li>
      <li class="nav-item mx-auto"><a class="nav-link active" href="/posts/expense">Dodaj wydatek</a></li>
      <li class="nav-item mx-auto"><a class="nav-link" href="/balance/balance">Przeglądaj bilans</a></li>
      <li class="nav-item mx-auto"><a class="nav-link" href="/settings/settings">Ustawienia</a></li>
      <li class="nav-item mx-auto"><a class="nav-link" href="/logout">Wyloguj się</a></li>
    </ol>
  </div>
</nav>

{% endblock %}

{% block head %}

<link rel="stylesheet" href="../css/money.css" type="text/css">

<script>
  
  checkData = () => {

    var selectPayment = document.getElementById("selectPayment");

    if (!selectPayment.value) {
      document.getElementById("infoPayment").innerHTML = "Wybierz płatność.";
    } else {
      document.getElementById("infoPayment").innerHTML = "";
    }
    
    var item = "Expense";

    $.ajax({
        url: '/Settings/getCategories',
        method: 'post',
        data: {item},
        success: function (data) {
          var itemsCategories = JSON.parse(data);
          var categories = [];
          var categoryNotChecked = true;

          for (i = 0; i < itemsCategories.length; i++) {
            categories[i] = document.getElementById("c" + itemsCategories[i][1]);
            if (categories[i].checked == true) {
              categoryNotChecked = false;
            }
          }

          if (categoryNotChecked) {
            document.getElementById("infoCategory").innerHTML = "Wybierz kategorię.";
          } else {
            document.getElementById("infoCategory").innerHTML = "";
          }

        },
        error: function (XMLHttpRequest, textStatus, errorThrown) {
          alert("Błąd!");
        }
    });
  }
</script>

{% endblock %}

{% block body %}

<div id="content_expense">
  <div class="container mt-1 mb-1">
    <div id="title">Dodawanie wydatku</div>
    <hr class="line mt-3 mb-4" style="width: 25em">
    <form method="post" action="/posts/create-expense" class="form_container">
      <div class="block_inputs">
        <div>
          <label>
            <div class="mb-1 ml-1 text-left">
              <small>Kwota :</small> 
            </div>
            <input class="form-control" type="number" step="0.01" min="0.01" name="amount" id="amount"
            value="{{ expense.amount }}" required>
          </label>
        </div>
        <div>
          <label>
            <div class="mb-1 ml-1 text-left">
              <small>Data : </small>
            </div>
            <input class="form-control" type="date" name="date" id="date1" value="{{ expense.date }}">
          </label>
        </div>
      </div>
      {% if expense.errors is not empty %}
      <div class='error'>
        {{ expense.errors[0] }}
      </div>
      {% endif %}
      <div class="block_payments">
        <select id="selectPayment" name="payment" class="form-control">
          <option value="" disabled selected>Wybierz sposób płatności</option>
          {% for method in paymentMethods %}
          <option value="{{method[1]}}">{{ method[0] }}</option>
          {% endfor %}
        </select>
        <p class="error mt-1" id="infoPayment"></p>
        {% if expense.errors is not empty %}
        <div class='error'>{{ expense.errors[1] }}</div>
        {% endif %}
      </div>
      <div>
        <div>
          <div class="mb-1 ml-1 mt-1 text-left">
            <small>Kategoria wydatku:</small>
          </div>
          {% for category in categoriesExpenses %}
          <label class="categoryInput col-12">
            <input class="mr-3" type="radio" id='c{{category[1]}}' name="category" value="{{category[1]}}">
            {{ category[0] }}
          </label>
          {% endfor %}
        </div>
        <p class="error mb-2" id="infoCategory"></p>
        {% if expense.errors is not empty %}
        <div class='error'>{{ expense.errors[2] }}</div>
        {% endif %}
      </div>
      <textarea name="comment" class="comment col-12" rows="1" cols="55" placeholder="Krótki komentarz (opcjonalnie)"
        onfocus="this.placeholder=''" onblur="this.placeholder='Krótki komentarz (opcjonalnie)'"></textarea>
      <div class="row justify-content-center mt-3">
        <input onclick="checkData()" id="expense_submit" type="submit" value="Dodaj wydatek" class="mr-5">
        <input id="expense_button" type="reset" value="Anuluj">
      </div>
    </form>
  </div>
</div>

{% endblock %}